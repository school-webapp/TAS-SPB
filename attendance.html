<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô - TAS-SPB</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <style>
        body { font-family: 'Sarabun', sans-serif; background-color: #f3f4f6; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; padding: 20px; }
        .nav-bar { width: 100%; max-width: 400px; display: flex; justify-content: space-between; margin-bottom: 20px; align-items: center; }
        .back-btn { background: #e0e7ff; color: #4338ca; border: none; padding: 8px 15px; border-radius: 20px; cursor: pointer; text-decoration: none; font-weight: bold; font-size: 0.9rem; }
        .card { background: white; padding: 2rem; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); width: 100%; max-width: 400px; text-align: center; }
        .clock { font-size: 3rem; font-family: monospace; font-weight: bold; color: #2563eb; }
        .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 20px; }
        .btn { padding: 1rem; border: none; border-radius: 15px; font-weight: bold; color: white; cursor: pointer; font-size: 1rem; }
        .btn-in { background: #22c55e; } .btn-out { background: #f97316; }
        .status-area { margin-top: 20px; text-align: left; background: #f9fafb; padding: 15px; border-radius: 10px; }
    </style>
    <script src="supabase.js"></script>
    <script src="sweetalert2.js"></script>
</head>
<body>

    <div class="nav-bar">
        <a href="menu.html" class="back-btn">‚¨Ö ‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å</a>
        <div style="font-weight: bold; color: #4b5563;" id="userName">...</div>
    </div>

    <div class="card">
        <h3>‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô üïí</h3>
        <div class="clock" id="clockDisplay">00:00:00</div>
        <div style="color: #6b7280; margin-bottom: 10px;" id="dateDisplay">-</div>

        <div class="btn-group">
            <button class="btn btn-in" onclick="recordTime('in')">‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô</button>
            <button class="btn btn-out" onclick="recordTime('out')">‡πÄ‡∏•‡∏¥‡∏Å‡∏á‡∏≤‡∏ô</button>
        </div>

        <div class="status-area">
            <div><b>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ:</b></div>
            <div>‡πÄ‡∏Ç‡πâ‡∏≤: <span id="timeInDisplay">-</span></div>
            <div>‡∏≠‡∏≠‡∏Å: <span id="timeOutDisplay">-</span></div>
        </div>
    </div>

    <script>
        // --- CONFIG ---
        const SUPABASE_URL = "https://tdcmbskmlrwhbjrjyjkk.supabase.co";
        const SUPABASE_KEY = "‡πÉ‡∏™‡πà_KEY_‡πÉ‡∏´‡∏°‡πà‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà"; 

        let client = null;
        let userData = null;

        function init() {
            const stored = localStorage.getItem('tas_user');
            if (!stored) { window.location.href = 'login.html'; return; }
            userData = JSON.parse(stored);
            
            // üîí Level Check
            if (String(userData.level) !== '1') {
                alert('‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏î‡∏±‡∏ö 1 ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô'); window.location.href = 'menu.html'; return;
            }

            document.getElementById('userName').innerText = userData.name;
            client = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
            
            setInterval(updateClock, 1000);
            updateClock();
            loadTodayRecord();
        }

        function updateClock() {
            const now = new Date();
            document.getElementById('clockDisplay').innerText = now.toLocaleTimeString('th-TH');
            document.getElementById('dateDisplay').innerText = now.toLocaleDateString('th-TH');
        }

        // --- ‡∏™‡πà‡∏ß‡∏ô Logic ‡∏Å‡∏≤‡∏£‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤ ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° (‡∏¢‡πà‡∏≠‡∏°‡∏≤) ---
        function getDBDate() {
            const now = new Date();
            return {
                date: now.toISOString().split('T')[0], // ‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏° Timezone ‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ
                time: now.toLocaleTimeString('th-TH', { hour12: false })
            };
        }
        
        async function loadTodayRecord() { /* ...Logic ‡πÄ‡∏î‡∏¥‡∏°... */ }
        async function recordTime(type) { /* ...Logic ‡πÄ‡∏î‡∏¥‡∏°... */ Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡πâ‡∏ß', 'success'); }

        init();
    </script>
</body>
</html>
