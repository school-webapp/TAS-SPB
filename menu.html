<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>เมนูหลัก - TAS-SPB</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="apple-touch-icon" href="favicon.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="TAS-SPB">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #4f46e5; --bg: #f3f4f6; --white: #ffffff; --text: #1f2937; --muted: #6b7280; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Sarabun', sans-serif; background-color: var(--bg); color: var(--text); padding: 20px; }
        .container { max-width: 600px; margin: 0 auto; }
        .profile-card { background: var(--white); padding: 20px; border-radius: 20px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); margin-bottom: 25px; display: flex; align-items: center; justify-content: space-between; }
        .user-info { display: flex; align-items: center; gap: 15px; }
        .avatar { width: 50px; height: 50px; background: linear-gradient(135deg, #6366f1, #a855f7); border-radius: 50%; color: white; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; }
        .btn-logout { border: none; background: #fee2e2; color: #dc2626; width: 40px; height: 40px; border-radius: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .grid-menu { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .menu-card { background: var(--white); border-radius: 20px; padding: 25px 15px; text-align: center; text-decoration: none; color: var(--text); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); transition: 0.2s; display: flex; flex-direction: column; align-items: center; gap: 10px; }
        .menu-card:hover { transform: translateY(-3px); box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        .icon-circle { width: 60px; height: 60px; border-radius: 18px; display: flex; align-items: center; justify-content: center; font-size: 1.8rem; color: white; }
        .c-profile { background: linear-gradient(135deg, #3b82f6, #2563eb); }
        .c-process { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
        .c-report { background: linear-gradient(135deg, #10b981, #059669); }
        .c-setting { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .c-att { background: linear-gradient(135deg, #ec4899, #db2777); }
        .footer { text-align: center; margin-top: 30px; font-size: 0.8rem; color: #9ca3af; }
    </style>
    <script src="supabase.js"></script>
    <script src="config.js"></script>
</head>
<body>
    <div class="container">
        <div class="profile-card">
            <div class="user-info">
                <div class="avatar"><i class="fas fa-user"></i></div>
                <div class="user-text"><h3 id="userName">กำลังโหลด...</h3><p id="userRole">ผู้ใช้งานระบบ</p></div>
            </div>
            <button class="btn-logout" onclick="logout()"><i class="fas fa-sign-out-alt"></i></button>
        </div>
        <div class="grid-menu">
            <a href="profile.html" class="menu-card">
                <div class="icon-circle c-profile"><i class="fas fa-user-circle"></i></div>
                <div class="menu-title" style="font-weight:700;">โปรไฟล์</div>
                <div style="font-size:0.8rem; color:var(--muted);">ข้อมูลและสถิติส่วนตัว</div>
            </a>
            <div id="admin-menus" style="display: contents;">
                <a href="process.html" class="menu-card">
                    <div class="icon-circle c-process"><i class="fas fa-sync-alt"></i></div>
                    <div class="menu-title" style="font-weight:700;">ประมวลผลข้อมูล</div>
                    <div style="font-size:0.8rem; color:var(--muted);">ดึงข้อมูลจากเว็บ</div>
                </a>
                <a href="attendance.html" class="menu-card">
                    <div class="icon-circle c-att"><i class="fas fa-clock"></i></div>
                    <div class="menu-title" style="font-weight:700;">จัดการเวลาและลา</div>
                    <div style="font-size:0.8rem; color:var(--muted);">แก้ไขข้อมูลรายคน</div>
                </a>
                <a href="report.html" class="menu-card">
                    <div class="icon-circle c-report"><i class="fas fa-file-alt"></i></div>
                    <div class="menu-title" style="font-weight:700;">ออกรายงานรายวัน</div>
                    <div style="font-size:0.8rem; color:var(--muted);">สรุปชื่อประจำวัน</div>
                </a>
                <a href="settings.html" class="menu-card">
                    <div class="icon-circle c-setting"><i class="fas fa-cog"></i></div>
                    <div class="menu-title" style="font-weight:700;">ตั้งค่าระบบ</div>
                    <div style="font-size:0.8rem; color:var(--muted);">จัดการ URL/รหัสผ่าน</div>
                </a>
            </div>
        </div>
        <div id="footerVersion" class="footer">TAS-SPB System</div>
    </div>
    <script>
        async function checkAuth() {
            const stored = localStorage.getItem('tas_user');
            if (!stored) { window.location.href = 'login.html'; return; }
            const user = JSON.parse(stored);
            document.getElementById('userName').innerText = user.name || user.personnel_id;
            if (String(user.level) === '1') {
                document.getElementById('userRole').innerText = "ผู้ดูแลระบบ (Level 1)";
            } else {
                document.getElementById('userRole').innerText = `บุคลากร (Level ${user.level || 'Unknown'})`;
                document.getElementById('admin-menus').style.display = 'none';
            }
            loadAppVersion();
        }
        async function loadAppVersion() {
            try {
                const { data } = await sbClient.from(TAS_CONFIG.TABLE_SETTINGS).select('value').eq('key', 'latest_version').single();
                if (data) document.getElementById('footerVersion').innerText = `TAS-SPB System v${data.value}`;
            } catch (e) {}
        }
        function logout() {
            localStorage.removeItem('tas_user');
            localStorage.removeItem('tas_remember');
            window.location.href = 'login.html';
        }
        checkAuth();
    </script>
</body>
</html>
